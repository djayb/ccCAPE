services:
  cccape:
    build: .
    container_name: cccape-tracker
    ports:
      - "8000:8000"
    environment:
      TRACKER_DB: /app/data/internal_jira.db
      TRACKER_SESSION_SECRET: change-this-session-secret
      TRACKER_ADMIN_USER: admin
      TRACKER_ADMIN_PASSWORD: admin123
      TRACKER_SEED: "true"
      TRACKER_HOST: 0.0.0.0
      TRACKER_PORT: "8000"
      SEC_USER_AGENT: ccCAPE/0.1 (replace-with-your-email@example.com)
    volumes:
      - ./data:/app/data
      - ./docs:/app/docs
    restart: unless-stopped

  cccape-weekly:
    build: .
    container_name: cccape-weekly
    entrypoint: ["python3", "/app/scripts/weekly_scheduler.py"]
    environment:
      TRACKER_DB: /app/data/internal_jira.db
      TRACKER_FREE_DATA_DB: /app/data/free_data.db
      SEC_USER_AGENT: ccCAPE/0.1 (replace-with-your-email@example.com)
      WEEKLY_TIMEZONE: America/New_York
      WEEKLY_RUN_DAY: SUN
      WEEKLY_RUN_HOUR: "9"
      WEEKLY_RUN_MINUTE: "0"
      WEEKLY_RUN_ON_STARTUP: "false"
      WEEKLY_UPDATE_TRACKER: "true"
      WEEKLY_FACTS_LIMIT: "200"
      WEEKLY_PRICES_SYMBOL_LIMIT: "503"
      WEEKLY_PRICES_ROWS_PER_SYMBOL: "3650"
      WEEKLY_REQUEST_DELAY: "0.25"
      WEEKLY_MIN_EPS_POINTS: "8"
      WEEKLY_LOOKBACK_YEARS: "10"
      WEEKLY_MARKET_CAP_MIN_COVERAGE: "0.8"
      WEEKLY_CALC_MARKDOWN_PATH: /app/docs/CC_CAPE_FREE_RUN.md
    volumes:
      - ./data:/app/data
      - ./docs:/app/docs
    restart: unless-stopped
    depends_on:
      - cccape
